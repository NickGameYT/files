"""
–ö–∞—Ñ–µ—Ç–µ—Ä–∏–π - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏
–£—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π, –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
"""

import sys
import logging
from datetime import datetime
from typing import Optional, List, Dict, Any
import mysql.connector
from mysql.connector import Error
from PySide6.QtWidgets import (
    QApplication,
    QMainWindow,
    QWidget,
    QVBoxLayout,
    QHBoxLayout,
    QLabel,
    QLineEdit,
    QComboBox,
    QPushButton,
    QTableWidget,
    QTableWidgetItem,
    QSpinBox,
    QCheckBox,
    QRadioButton,
    QScrollArea,
    QGridLayout,
    QFrame,
    QMessageBox,
    QStackedWidget,
    QDialog,
    QGroupBox,
    QButtonGroup,
    QProgressBar,
    QStatusBar,
    QToolBar,
    QAction,
    QTabWidget,
    QSplitter,
)
from PySide6.QtCore import Qt, Signal, Slot, QTimer, QSize
from PySide6.QtGui import QFont, QIcon, QPixmap, QColor

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('cafeteria_system.log'),
        logging.StreamHandler()
    ]
)
logger = logging.getLogger(__name__)

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
class AppConfig:
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    DATABASE_CONFIG = {
        "host": "127.0.0.1",
        "user": "root",
        "password": "Lbhtrnjh_4231",
        "database": "cafeteria_db",
        "port": 3305,
        "pool_name": "cafeteria_pool",
        "pool_size": 5,
        "autocommit": True
    }
    
    APP_NAME = "–ö–∞—Ñ–µ—Ç–µ—Ä–∏–π Pro"
    VERSION = "2.0.0"
    COMPANY = "FoodTech Solutions"
    
    # –¢–∞–π–º–∞—É—Ç—ã –∏ –ª–∏–º–∏—Ç—ã
    DB_CONNECTION_TIMEOUT = 10
    MAX_RECONNECT_ATTEMPTS = 3
    SESSION_TIMEOUT_MINUTES = 30
    
    # –ü—É—Ç–∏ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ)
    ICON_PATHS = {
        "app": "icons/app_icon.png",
        "cart": "icons/cart.png",
        "product": "icons/product.png",
        "user": "icons/user.png",
        "settings": "icons/settings.png"
    }

# –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–µ–º
class ThemeManager:
    """–ú–µ–Ω–µ–¥–∂–µ—Ä —Ç–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è"""
    
    THEMES = {
        "light": {
            "primary": "#FF5722",
            "primary_dark": "#E64A19",
            "secondary": "#2196F3",
            "background": "#FFFFFF",
            "surface": "#FAFAFA",
            "text_primary": "#212121",
            "text_secondary": "#757575",
            "border": "#E0E0E0",
            "success": "#4CAF50",
            "warning": "#FF9800",
            "error": "#F44336",
        },
        "dark": {
            "primary": "#FF7043",
            "primary_dark": "#F4511E",
            "secondary": "#64B5F6",
            "background": "#121212",
            "surface": "#1E1E1E",
            "text_primary": "#FFFFFF",
            "text_secondary": "#B0B0B0",
            "border": "#424242",
            "success": "#66BB6A",
            "warning": "#FFB74D",
            "error": "#EF5350",
        }
    }
    
    @classmethod
    def get_style_sheet(cls, theme_name="light"):
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∏–ª–µ–π –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º—ã"""
        theme = cls.THEMES.get(theme_name, cls.THEMES["light"])
        
        return f"""
            /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
            QMainWindow, QWidget, QDialog {{
                background: {theme['background']};
                color: {theme['text_primary']};
                font-family: 'Segoe UI', Arial, sans-serif;
            }}
            
            /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
            QLabel[class="title"] {{
                font-size: 18px;
                font-weight: bold;
                color: {theme['primary']};
                padding: 10px 0;
            }}
            
            QLabel[class="subtitle"] {{
                font-size: 14px;
                color: {theme['text_secondary']};
            }}
            
            /* –ö–Ω–æ–ø–∫–∏ */
            QPushButton {{
                background: {theme['primary']};
                color: white;
                border: none;
                border-radius: 6px;
                padding: 12px 20px;
                font-weight: 600;
                font-size: 14px;
                transition: background 0.3s;
            }}
            
            QPushButton:hover {{
                background: {theme['primary_dark']};
            }}
            
            QPushButton:disabled {{
                background: {theme['border']};
                color: {theme['text_secondary']};
            }}
            
            QPushButton[class="secondary"] {{
                background: {theme['secondary']};
            }}
            
            QPushButton[class="secondary"]:hover {{
                background: #1976D2;
            }}
            
            QPushButton[class="small"] {{
                padding: 6px 12px;
                font-size: 12px;
            }}
            
            /* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
            QLineEdit, QComboBox, QSpinBox {{
                border: 2px solid {theme['border']};
                border-radius: 6px;
                padding: 10px;
                background: {theme['surface']};
                color: {theme['text_primary']};
                font-size: 14px;
                selection-background-color: {theme['primary']};
            }}
            
            QLineEdit:focus, QComboBox:focus, QSpinBox:focus {{
                border-color: {theme['primary']};
            }}
            
            QComboBox::drop-down {{
                border: none;
            }}
            
            QComboBox QAbstractItemView {{
                background: {theme['surface']};
                color: {theme['text_primary']};
                border: 1px solid {theme['border']};
                selection-background-color: {theme['primary']};
            }}
            
            /* –¢–∞–±–ª–∏—Ü—ã */
            QTableWidget {{
                background: {theme['surface']};
                color: {theme['text_primary']};
                gridline-color: {theme['border']};
                border: 1px solid {theme['border']};
                border-radius: 6px;
                font-size: 14px;
            }}
            
            QTableWidget::item {{
                padding: 8px;
            }}
            
            QTableWidget::item:selected {{
                background: {theme['primary']};
                color: white;
            }}
            
            QHeaderView::section {{
                background: {theme['surface']};
                color: {theme['text_primary']};
                padding: 12px;
                border: 1px solid {theme['border']};
                font-weight: bold;
            }}
            
            /* –§—Ä–µ–π–º—ã –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
            QFrame[class="card"] {{
                background: {theme['surface']};
                border: 1px solid {theme['border']};
                border-radius: 10px;
                padding: 15px;
            }}
            
            QFrame[class="highlight"] {{
                border: 2px solid {theme['primary']};
            }}
            
            /* –ß–µ–∫–±–æ–∫—Å—ã –∏ —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏ */
            QCheckBox, QRadioButton {{
                color: {theme['text_primary']};
                font-size: 14px;
                spacing: 10px;
            }}
            
            QCheckBox::indicator, QRadioButton::indicator {{
                width: 18px;
                height: 18px;
            }}
            
            /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
            QProgressBar {{
                border: 1px solid {theme['border']};
                border-radius: 4px;
                text-align: center;
                background: {theme['surface']};
            }}
            
            QProgressBar::chunk {{
                background: {theme['primary']};
                border-radius: 4px;
            }}
            
            /* –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã */
            .success {{ color: {theme['success']}; }}
            .warning {{ color: {theme['warning']}; }}
            .error {{ color: {theme['error']}; }}
            .primary {{ color: {theme['primary']}; }}
            
            /* ToolBar */
            QToolBar {{
                background: {theme['surface']};
                border-bottom: 1px solid {theme['border']};
                spacing: 10px;
                padding: 5px;
            }}
            
            QToolBar QToolButton {{
                padding: 8px;
                border-radius: 4px;
            }}
            
            QToolBar QToolButton:hover {{
                background: rgba(255, 87, 34, 0.1);
            }}
        """


class EnhancedDatabaseManager:
    """–£—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –ø—É–ª–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫"""
    
    _instance = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
            cls._instance._initialized = False
        return cls._instance
    
    def __init__(self):
        if self._initialized:
            return
            
        self.config = AppConfig.DATABASE_CONFIG
        self.connection_pool = None
        self.reconnect_attempts = 0
        self._initialize_pool()
        self._initialized = True
    
    def _initialize_pool(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π"""
        try:
            self.connection_pool = mysql.connector.pooling.MySQLConnectionPool(
                **self.config
            )
            logger.info("–ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        except Error as e:
            logger.error(f"–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π: {e}")
            self.connection_pool = None
    
    def get_connection(self):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–∑ –ø—É–ª–∞ —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏"""
        if not self.connection_pool:
            self._initialize_pool()
            
        for attempt in range(AppConfig.MAX_RECONNECT_ATTEMPTS):
            try:
                conn = self.connection_pool.get_connection()
                if conn.is_connected():
                    self.reconnect_attempts = 0
                    return conn
            except Error as e:
                logger.warning(f"–ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: {e}")
                if attempt < AppConfig.MAX_RECONNECT_ATTEMPTS - 1:
                    import time
                    time.sleep(1)
        
        logger.error("–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫")
        return None
    
    def execute_query(self, query: str, params: tuple = (), fetch_all: bool = True):
        """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫"""
        conn = self.get_connection()
        if not conn:
            return [] if fetch_all else None
            
        try:
            cursor = conn.cursor(dictionary=True)
            cursor.execute(query, params)
            
            if fetch_all:
                result = cursor.fetchall()
            else:
                result = cursor.fetchone()
            
            if query.strip().upper().startswith(('INSERT', 'UPDATE', 'DELETE')):
                conn.commit()
                last_id = cursor.lastrowid
                logger.info(f"–ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω: {query[:50]}...")
                return last_id if last_id else cursor.rowcount
            
            cursor.close()
            return result
            
        except Error as e:
            logger.error(f"–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞: {e}\n–ó–∞–ø—Ä–æ—Å: {query}")
            conn.rollback()
            return [] if fetch_all else None
        finally:
            if conn:
                conn.close()
    
    def health_check(self) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
        try:
            result = self.execute_query("SELECT 1 as status", fetch_all=False)
            return result is not None and result.get('status') == 1
        except:
            return False


class EnhancedAuthDialog(QDialog):
    """–£—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
    
    login_successful = Signal(str)  # –°–∏–≥–Ω–∞–ª —Å –∏–º–µ–Ω–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setWindowTitle(f"{AppConfig.APP_NAME} - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è")
        self.setFixedSize(420, 300)
        self.setStyleSheet(ThemeManager.get_style_sheet())
        
        self.user_role = None
        self.setup_ui()
        self.setup_connections()
    
    def setup_ui(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞"""
        main_layout = QVBoxLayout(self)
        main_layout.setSpacing(20)
        main_layout.setContentsMargins(30, 30, 30, 30)
        
        # –ó–∞–≥–æ–ª–æ–≤–æ–∫
        title_label = QLabel(f"<h1>üîê {AppConfig.APP_NAME}</h1>")
        title_label.setAlignment(Qt.AlignCenter)
        title_label.setProperty("class", "title")
        main_layout.addWidget(title_label)
        
        # –ü–æ–ª—è –≤–≤–æ–¥–∞
        form_layout = QVBoxLayout()
        form_layout.setSpacing(15)
        
        # –õ–æ–≥–∏–Ω
        login_layout = QVBoxLayout()
        login_label = QLabel("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:")
        login_label.setProperty("class", "subtitle")
        self.username_input = QLineEdit()
        self.username_input.setPlaceholderText("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ª–æ–≥–∏–Ω")
        self.username_input.setMinimumHeight(40)
        login_layout.addWidget(login_label)
        login_layout.addWidget(self.username_input)
        form_layout.addLayout(login_layout)
        
        # –ü–∞—Ä–æ–ª—å
        password_layout = QVBoxLayout()
        password_label = QLabel("–ü–∞—Ä–æ–ª—å:")
        password_label.setProperty("class", "subtitle")
        self.password_input = QLineEdit()
        self.password_input.setPlaceholderText("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å")
        self.password_input.setEchoMode(QLineEdit.Password)
        self.password_input.setMinimumHeight(40)
        password_layout.addWidget(password_label)
        password_layout.addWidget(self.password_input)
        form_layout.addLayout(password_layout)
        
        # –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        role_layout = QVBoxLayout()
        role_label = QLabel("–†–æ–ª—å:")
        role_label.setProperty("class", "subtitle")
        self.role_combo = QComboBox()
        self.role_combo.addItems(["–û–ø–µ—Ä–∞—Ç–æ—Ä-–∫–∞—Å—Å–∏—Ä", "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", "–ú–µ–Ω–µ–¥–∂–µ—Ä"])
        self.role_combo.setMinimumHeight(40)
        role_layout.addWidget(role_label)
        role_layout.addWidget(self.role_combo)
        form_layout.addLayout(role_layout)
        
        main_layout.addLayout(form_layout)
        
        # –ö–Ω–æ–ø–∫–∏
        button_layout = QHBoxLayout()
        self.login_button = QPushButton("–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É")
        self.login_button.setMinimumHeight(45)
        self.login_button.setProperty("class", "primary")
        
        self.cancel_button = QPushButton("–û—Ç–º–µ–Ω–∞")
        self.cancel_button.setMinimumHeight(45)
        self.cancel_button.setProperty("class", "secondary")
        
        button_layout.addWidget(self.cancel_button)
        button_layout.addWidget(self.login_button)
        main_layout.addLayout(button_layout)
        
        # –°—Ç–∞—Ç—É—Å
        self.status_label = QLabel("")
        self.status_label.setAlignment(Qt.AlignCenter)
        self.status_label.setProperty("class", "subtitle")
        main_layout.addWidget(self.status_label)
    
    def setup_connections(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤"""
        self.login_button.clicked.connect(self.authenticate_user)
        self.cancel_button.clicked.connect(self.reject)
        
        # –í–≤–æ–¥ –ø–æ Enter
        self.username_input.returnPressed.connect(self.authenticate_user)
        self.password_input.returnPressed.connect(self.authenticate_user)
    
    @Slot()
    def authenticate_user(self):
        """–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        username = self.username_input.text().strip()
        password = self.password_input.text()
        role = self.role_combo.currentText()
        
        if not username or not password:
            self.show_status("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!", "error")
            return
        
        # –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ –ë–î)
        valid_users = {
            "admin": "123",
            "operator": "123",
            "manager": "123"
        }
        
        if username in valid_users and password == valid_users[username]:
            self.user_role = role
            self.show_status(f"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {username}!", "success")
            QTimer.singleShot(1000, lambda: self.accept_login(username))
        else:
            self.show_status("–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!", "error")
            self.password_input.clear()
    
    def accept_login(self, username):
        """–ü—Ä–∏–Ω—è—Ç—å –≤—Ö–æ–¥ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–∏–≥–Ω–∞–ª"""
        self.login_successful.emit(username)
        self.accept()
    
    def show_status(self, message: str, msg_type: str = "info"):
        """–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"""
        color_map = {
            "success": "green",
            "error": "red",
            "warning": "orange",
            "info": "blue"
        }
        
        self.status_label.setText(message)
        self.status_label.setStyleSheet(f"color: {color_map.get(msg_type, 'black')};")


class ProductCard(QFrame):
    """–£—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞"""
    
    add_to_cart = Signal(dict)
    view_details = Signal(dict)
    quick_add = Signal(dict, int)  # –¢–æ–≤–∞—Ä –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    
    def __init__(self, product_data: Dict[str, Any]):
        super().__init__()
        self.product_data = product_data
        self.setup_ui()
        self.setup_style()
        self.setup_connections()
    
    def setup_ui(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∫–∞—Ä—Ç–æ—á–∫–∏"""
        self.setFixedSize(280, 350)
        self.setCursor(Qt.PointingHandCursor)
        self.setProperty("class", "card")
        
        layout = QVBoxLayout(self)
        layout.setSpacing(10)
        layout.setContentsMargins(15, 15, 15, 15)
        
        # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
        self.image_label = QLabel()
        self.image_label.setFixedSize(250, 120)
        self.image_label.setAlignment(Qt.AlignCenter)
        self.load_product_image()
        layout.addWidget(self.image_label)
        
        # –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
        name_label = QLabel(f"<b>{self.product_data.get('name', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')}</b>")
        name_label.setWordWrap(True)
        name_label.setMaximumHeight(40)
        layout.addWidget(name_label)
        
        # –û–ø–∏—Å–∞–Ω–∏–µ
        description = self.product_data.get('description', '')
        if len(description) > 60:
            description = description[:60] + '...'
        desc_label = QLabel(description)
        desc_label.setWordWrap(True)
        desc_label.setStyleSheet("color: #666; font-size: 12px;")
        layout.addWidget(desc_label)
        
        # –ö–∞—Ç–µ–≥–æ—Ä–∏—è
        category = self.product_data.get('category_name', '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏')
        cat_label = QLabel(f"üìÅ {category}")
        cat_label.setStyleSheet("color: #888; font-size: 11px;")
        layout.addWidget(cat_label)
        
        layout.addStretch()
        
        # –ü–∞–Ω–µ–ª—å —Å —Ü–µ–Ω–æ–π –∏ –∫–Ω–æ–ø–∫–∞–º–∏
        bottom_panel = QHBoxLayout()
        
        # –¶–µ–Ω–∞
        price = float(self.product_data.get('price', 0))
        price_label = QLabel(f"<b style='color: #FF5722; font-size: 16px;'>{price:.2f} ‚ÇΩ</b>")
        bottom_panel.addWidget(price_label)
        
        bottom_panel.addStretch()
        
        # –ö–Ω–æ–ø–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        self.quick_add_btn = QPushButton("+1")
        self.quick_add_btn.setFixedSize(40, 30)
        self.quick_add_btn.setToolTip("–ë—ã—Å—Ç—Ä–æ –¥–æ–±–∞–≤–∏—Ç—å 1 —à—Ç.")
        bottom_panel.addWidget(self.quick_add_btn)
        
        # –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        self.add_btn = QPushButton("–í –∫–æ—Ä–∑–∏–Ω—É")
        self.add_btn.setFixedSize(90, 30)
        self.add_btn.setProperty("class", "small")
        bottom_panel.addWidget(self.add_btn)
        
        layout.addLayout(bottom_panel)
    
    def load_product_image(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
        # –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
        self.image_label.setText("üñºÔ∏è\n–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ\n—Ç–æ–≤–∞—Ä–∞")
        self.image_label.setStyleSheet("""
            background: qlineargradient(x1:0, y1:0, x2:0, y2:1,
                stop:0 #F5F5F5, stop:1 #EEEEEE);
            border: 2px dashed #DDD;
            border-radius: 8px;
            color: #999;
            font-size: 12px;
        """)
    
    def setup_style(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∏–ª–µ–π"""
        self.setStyleSheet("""
            ProductCard:hover {
                border: 2px solid #FF5722;
                background: #FFF8F6;
            }
        """)
    
    def setup_connections(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤"""
        self.add_btn.clicked.connect(
            lambda: self.add_to_cart.emit(self.product_data)
        )
        self.quick_add_btn.clicked.connect(
            lambda: self.quick_add.emit(self.product_data, 1)
        )
    
    def mouseDoubleClickEvent(self, event):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π"""
        if event.button() == Qt.LeftButton:
            self.view_details.emit(self.product_data)
    
    def enterEvent(self, event):
        """–≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏"""
        self.setProperty("class", "card highlight")
        self.style().polish(self)
    
    def leaveEvent(self, event):
        """–≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ —É—Ö–æ–¥–µ –∫—É—Ä—Å–æ—Ä–∞"""
        self.setProperty("class", "card")
        self.style().polish(self)


class EnhancedProductCatalog(QWidget):
    """–£—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤"""
    
    item_added = Signal(dict)
    show_cart = Signal()
    show_product_details = Signal(dict)
    
    def __init__(self, db_manager: EnhancedDatabaseManager):
        super().__init__()
        self.db = db_manager
        self.current_sort = "price_asc"
        self.current_category = None
        self.setup_ui()
        self.load_initial_data()
    
    def setup_ui(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∫–∞—Ç–∞–ª–æ–≥–∞"""
        main_layout = QVBoxLayout(self)
        main_layout.setSpacing(15)
        main_layout.setContentsMargins(20, 20, 20, 20)
        
        # –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
        header_layout = QHBoxLayout()
        
        title_label = QLabel("<h1>üçΩÔ∏è –ú–µ–Ω—é –∫–∞—Ñ–µ—Ç–µ—Ä–∏—è</h1>")
        title_label.setProperty("class", "title")
        header_layout.addWidget(title_label)
        
        header_layout.addStretch()
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        self.stats_label = QLabel("–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...")
        self.stats_label.setProperty("class", "subtitle")
        header_layout.addWidget(self.stats_label)
        
        # –ö–Ω–æ–ø–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
        self.cart_button = QPushButton("üõí –ö–æ—Ä–∑–∏–Ω–∞ (0)")
        self.cart_button.setProperty("class", "secondary")
        self.cart_button.clicked.connect(self.show_cart.emit)
        header_layout.addWidget(self.cart_button)
        
        main_layout.addLayout(header_layout)
        
        # –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤
        filters_group = QGroupBox("–§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫")
        filters_layout = QGridLayout()
        
        # –ü–æ–∏—Å–∫
        search_label = QLabel("–ü–æ–∏—Å–∫:")
        self.search_input = QLineEdit()
        self.search_input.setPlaceholderText("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞...")
        self.search_input.textChanged.connect(self.apply_filters)
        filters_layout.addWidget(search_label, 0, 0)
        filters_layout.addWidget(self.search_input, 0, 1, 1, 3)
        
        # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
        category_label = QLabel("–ö–∞—Ç–µ–≥–æ—Ä–∏—è:")
        self.category_combo = QComboBox()
        self.category_combo.currentIndexChanged.connect(self.apply_filters)
        filters_layout.addWidget(category_label, 1, 0)
        filters_layout.addWidget(self.category_combo, 1, 1)
        
        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
        sort_label = QLabel("–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:")
        self.sort_combo = QComboBox()
        self.sort_combo.addItems([
            "–ü–æ —Ü–µ–Ω–µ (–≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ)",
            "–ü–æ —Ü–µ–Ω–µ (—É–±—ã–≤–∞–Ω–∏–µ)",
            "–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê-–Ø)",
            "–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–Ø-–ê)",
            "–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏"
        ])
        self.sort_combo.currentIndexChanged.connect(self.apply_filters)
        filters_layout.addWidget(sort_label, 1, 2)
        filters_layout.addWidget(self.sort_combo, 1, 3)
        
        # –ö–Ω–æ–ø–∫–∏ —Å–±—Ä–æ—Å–∞
        reset_button = QPushButton("–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã")
        reset_button.clicked.connect(self.reset_filters)
        filters_layout.addWidget(reset_button, 2, 3)
        
        filters_group.setLayout(filters_layout)
        main_layout.addWidget(filters_group)
        
        # –û–±–ª–∞—Å—Ç—å —Å —Ç–æ–≤–∞—Ä–∞–º–∏
        self.scroll_area = QScrollArea()
        self.scroll_area.setWidgetResizable(True)
        self.scroll_area.setHorizontalScrollBarPolicy(Qt.ScrollBarAlwaysOff)
        
        self.products_container = QWidget()
        self.grid_layout = QGridLayout(self.products_container)
        self.grid_layout.setSpacing(20)
        self.grid_layout.setAlignment(Qt.AlignTop | Qt.AlignLeft)
        
        self.scroll_area.setWidget(self.products_container)
        main_layout.addWidget(self.scroll_area, 1)
        
        # –ü–∞–Ω–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è
        self.status_bar = QStatusBar()
        self.status_bar.showMessage("–ì–æ—Ç–æ–≤–æ")
        main_layout.addWidget(self.status_bar)
    
    def load_initial_data(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
        self.load_categories()
        self.apply_filters()
    
    def load_categories(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
        self.category_combo.clear()
        self.category_combo.addItem("–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", None)
        
        try:
            categories = self.db.execute_query(
                "SELECT id, name, COUNT(p.id) as product_count "
                "FROM categories c LEFT JOIN products p ON c.id = p.category_id "
                "WHERE p.is_active = 1 OR p.is_active IS NULL "
                "GROUP BY c.id, c.name ORDER BY c.name"
            )
            
            for cat in categories:
                self.category_combo.addItem(
                    f"{cat['name']} ({cat['product_count']})",
                    cat['id']
                )
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: {e}")
    
    def apply_filters(self):
        """–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤"""
        search_text = self.search_input.text().strip()
        category_id = self.category_combo.currentData()
        sort_index = self.sort_combo.currentIndex()
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        sort_map = {
            0: "p.price ASC",
            1: "p.price DESC",
            2: "p.name ASC",
            3: "p.name DESC",
            4: "p.popularity DESC, p.name ASC"
        }
        sort_order = sort_map.get(sort_index, "p.name ASC")
        
        # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
        query = """
            SELECT p.*, c.name as category_name, 
                   COALESCE(SUM(os.current_count), 0) as total_sold
            FROM products p 
            LEFT JOIN categories c ON p.category_id = c.id
            LEFT JOIN order_shopcase os ON p.id = os.product_id
            WHERE p.is_active = 1
        """
        params = []
        
        if search_text:
            query += " AND (p.name LIKE %s OR p.description LIKE %s)"
            params.extend([f"%{search_text}%", f"%{search_text}%"])
        
        if category_id:
            query += " AND p.category_id = %s"
            params.append(category_id)
        
        query += f" GROUP BY p.id, p.name, p.price, p.description, p.category_id, c.name"
        query += f" ORDER BY {sort_order}"
        
        # –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
        self.load_products(query, params)
    
    def load_products(self, query: str, params: list):
        """–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
        # –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
        while self.grid_layout.count():
            item = self.grid_layout.takeAt(0)
            if item.widget():
                item.widget().deleteLater()
        
        try:
            products = self.db.execute_query(query, params)
            
            if not products:
                empty_label = QLabel("–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞.")
                empty_label.setAlignment(Qt.AlignCenter)
                empty_label.setStyleSheet("font-size: 16px; color: #999; padding: 50px;")
                self.grid_layout.addWidget(empty_label, 0, 0, 1, 4)
                self.stats_label.setText("–¢–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
                return
            
            # –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
            for i, product in enumerate(products):
                row = i // 4
                col = i % 4
                
                card = ProductCard(product)
                card.add_to_cart.connect(self.item_added.emit)
                card.view_details.connect(self.show_product_details.emit)
                card.quick_add.connect(self.handle_quick_add)
                
                self.grid_layout.addWidget(card, row, col)
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            total_value = sum(float(p['price']) * float(p.get('total_sold', 0)) for p in products)
            self.stats_label.setText(
                f"–¢–æ–≤–∞—Ä–æ–≤: {len(products)} | "
                f"–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: {total_value:,.2f} ‚ÇΩ"
            )
            self.status_bar.showMessage(f"–ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤", 3000)
            
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
            self.status_bar.showMessage(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {str(e)}", 5000)
    
    def reset_filters(self):
        """–°–±—Ä–æ—Å –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤"""
        self.search_input.clear()
        self.category_combo.setCurrentIndex(0)
        self.sort_combo.setCurrentIndex(0)
    
    def handle_quick_add(self, product: dict, quantity: int):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞"""
        # –í—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        product_copy = product.copy()
        for _ in range(quantity - 1):
            self.item_added.emit(product_copy)
        
        # –û—Å–Ω–æ–≤–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
        self.item_added.emit(product)
        self.show_notification(f"–î–æ–±–∞–≤–ª–µ–Ω–æ {quantity} —à—Ç. '{product['name']}'")
    
    def show_notification(self, message: str):
        """–ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"""
        self.status_bar.showMessage(message, 2000)
    
    def update_cart_count(self, count: int):
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã"""
        self.cart_button.setText(f"üõí –ö–æ—Ä–∑–∏–Ω–∞ ({count})")


class EnhancedShoppingCart(QWidget):
    """–£—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ –∑–∞–∫–∞–∑–æ–≤"""
    
    return_to_catalog = Signal()
    order_processed = Signal(int)  # –°–∏–≥–Ω–∞–ª —Å ID –∑–∞–∫–∞–∑–∞
    
    def __init__(self, db_manager: EnhancedDatabaseManager):
        super().__init__()
        self.db = db_manager
        self.cart_items = []
        self.total_amount = 0.0
        self.setup_ui()
        self.load_clients()
    
    def setup_ui(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∫–æ—Ä–∑–∏–Ω—ã"""
        main_splitter = QSplitter(Qt.Horizontal)
        
        # –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ
        left_widget = QWidget()
        left_layout = QVBoxLayout(left_widget)
        left_layout.setSpacing(15)
        
        # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
        header_layout = QHBoxLayout()
        back_button = QPushButton("‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–∞–ª–æ–≥—É")
        back_button.clicked.connect(self.return_to_catalog.emit)
        header_layout.addWidget(back_button)
        
        header_layout.addStretch()
        
        title_label = QLabel("<h1>üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h1>")
        title_label.setProperty("class", "title")
        header_layout.addWidget(title_label)
        
        header_layout.addStretch()
        
        clear_button = QPushButton("–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É")
        clear_button.clicked.connect(self.clear_cart)
        clear_button.setProperty("class", "secondary")
        header_layout.addWidget(clear_button)
        
        left_layout.addLayout(header_layout)
        
        # –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤
        self.cart_table = QTableWidget()
        self.cart_table.setColumnCount(6)
        self.cart_table.setHorizontalHeaderLabels([
            "‚Ññ", "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ", "–¶–µ–Ω–∞", "–ö–æ–ª-–≤–æ", "–°—É–º–º–∞", "–î–µ–π—Å—Ç–≤–∏—è"
        ])
        self.cart_table.horizontalHeader().setStretchLastSection(True)
        left_layout.addWidget(self.cart_table, 1)
        
        # –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞
        total_layout = QHBoxLayout()
        total_layout.addStretch()
        self.total_label = QLabel("<h2>–ò—Ç–æ–≥–æ: 0.00 ‚ÇΩ</h2>")
        self.total_label.setStyleSheet("color: #FF5722; font-weight: bold;")
        total_layout.addWidget(self.total_label)
        left_layout.addLayout(total_layout)
        
        main_splitter.addWidget(left_widget)
        
        # –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
        right_widget = QWidget()
        right_layout = QVBoxLayout(right_widget)
        right_layout.setSpacing(20)
        
        order_group = QGroupBox("–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞")
        order_layout = QVBoxLayout()
        
        # –ö–ª–∏–µ–Ω—Ç
        client_layout = QVBoxLayout()
        client_label = QLabel("–ö–ª–∏–µ–Ω—Ç:")
        self.client_combo = QComboBox()
        self.client_combo.setMinimumHeight(40)
        client_layout.addWidget(client_label)
        client_layout.addWidget(self.client_combo)
        
        self.no_client_check = QCheckBox("–ë–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞")
        self.no_client_check.stateChanged.connect(
            lambda s: self.client_combo.setEnabled(not s)
        )
        client_layout.addWidget(self.no_client_check)
        order_layout.addLayout(client_layout)
        
        # –¢–∏–ø –∑–∞–∫–∞–∑–∞
        type_group = QGroupBox("–¢–∏–ø –ø–æ–ª—É—á–µ–Ω–∏—è")
        type_layout = QVBoxLayout()
        
        self.type_button_group = QButtonGroup(self)
        self.type_in_store = QRadioButton("üçΩÔ∏è –í –∑–∞–≤–µ–¥–µ–Ω–∏–∏")
        self.type_takeaway = QRadioButton("ü•° –ù–∞ –≤—ã–Ω–æ—Å")
        self.type_delivery = QRadioButton("üöö –î–æ—Å—Ç–∞–≤–∫–∞")
        
        self.type_button_group.addButton(self.type_in_store, 1
